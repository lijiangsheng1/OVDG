<?xml version="1.0" encoding="UTF-8"?>
<section xmlns="http://docbook.org/ns/docbook"
  xmlns:xi="http://www.w3.org/2001/XInclude"
  xmlns:xlink="http://www.w3.org/1999/xlink"
  version="5.0"
  xml:id="vdsm_storage">
  <title>VDSM存储管理</title>
  <para>在开始之前，我们先来看几个问题：</para>
   <itemizedlist>
      <listitem><para>要管理成百上千个虚拟机的磁盘镜像(系统，数据，快照等)。</para></listitem>
      <listitem><para>每个磁盘镜像都可能被集群内上百个节点的任意一台主机访问到。</para></listitem>
      <listitem><para>不仅需要支持文件系统，还需支持裸的块存储。</para></listitem>
      <listitem><para>高可用，高性能。</para></listitem>
   </itemizedlist>
  <para>VDSM使用存储域的概念来管理存储，存储域具有如下特定:</para>
   <itemizedlist>
      <listitem><para>一个单一的存储实体。</para></listitem>
      <listitem><para>存放镜像及描述自身的元数据。</para></listitem>
      <listitem><para>VDSM中唯一的持久存储。</para></listitem>
      <listitem><para>网卡绑定</para></listitem>
   </itemizedlist>
  <para>存储域按照用途有下面几种：</para>   
   <itemizedlist>
      <listitem><para>数据</para></listitem>
       <itemizedlist>
         <listitem><para>主要</para></listitem>
         <listitem><para>其它</para></listitem>
       </itemizedlist>
      <listitem><para>ISO(NFS)</para></listitem>
      <listitem><para>备份(NFS)</para></listitem>
   </itemizedlist>
  <para>正如我们在源代码树中所看到的，VDSM将存储的类型区分为两种，即块设备和文件系统。
        那么存储域根据此不同的类型，也做了两个归类：</para>
   <itemizedlist>
      <listitem><para>文件存储域:</para></listitem>
       <itemizedlist>
         <listitem><para>NFS</para></listitem>
         <listitem><para>本地文件系统</para></listitem>
         <listitem><para>GlusterFS</para></listitem>
         <listitem><para>Posix标准的集群文件系统，如OCFS2,GPFS等</para></listitem>
       </itemizedlist>
       <para>基于文件系统存储域具有如下特征：</para>
       <itemizedlist>
         <listitem><para>稀疏文件</para></listitem>
         <listitem><para>较好的镜像操作能力</para></listitem>
         <listitem><para>卷和元数据均为文件。</para></listitem>
         <listitem><para>1：1的存储域和导出域的比例。</para></listitem>
       </itemizedlist>
      <listitem><para>块设备存储域</para></listitem>
       <itemizedlist>
         <listitem><para>iSCSI</para></listitem>
         <listitem><para>光纤存储</para></listitem>
         <listitem><para>FCoE</para></listitem>
       </itemizedlist>
       <para>基于块设备存储域具有如下特征：</para>
       <itemizedlist>
         <listitem><para>使用device-mapper和multipath来管理设备。</para></listitem>
         <listitem><para>将整个存储域视为一个VG</para></listitem>
         <listitem><para>卷就是一个LV</para></listitem>
         <listitem><para>元数据也是单独存放在一个lv中，打了lvg标签。</para></listitem>
         <listitem><para>使用简单的邮筒原理。</para></listitem>
       </itemizedlist>
   </itemizedlist>
  <para>基于块存储时的thin provison实现原理：</para>
     <mediaobject>
        <imageobject>
            <imagedata fileref="../media/vdsm_block_thin_provison.png" width="6in" />
        </imageobject>
     </mediaobject>
</section>
